✅ App: init() - App instance created!
✅ AppDelegate: init() - AppDelegate instance created!
✅ App: appDelegate = <openai_transcriber_ios.AppDelegate: 0x30152c110>
✅ AppDelegate: didFinishLaunchingWithOptions - AppDelegateが初期化されました！
✅ BackgroundSessionManager initialized
✅ AppDelegate: BackgroundSessionManager = <openai_transcriber_ios.BackgroundSessionManager: 0x30027c600>
✅ Loaded 10 history items from UserDefaults.
🗄️ HistoryManager initialized. Documents Directory: /var/mobile/Containers/Data/Application/5482472C-556F-4D00-9909-19A403CF1FA8/Documents
✅ App: ContentView appeared
✅ App: AppDelegate instance = Optional(<SwiftUI.AppDelegate: 0x3019430f0>)

➕ Started new history item: ID 6CECBE20-FA5B-4D79-A13B-CA1C50633C89
🗑️ Deleting old history item (due to new session): F45F1C73-4089-4E17-9E2F-50EA1DB22362
✅ Saved 10 history items to UserDefaults.
Starting recorder

🎙️ Recording started in auto mode
🎙️ Input format: <AVAudioFormat 0x30344c550:  1 ch,  48000 Hz, Float32>
🎙️ Output format: Optional(<AVAudioFormat 0x303415900:  1 ch,  16000 Hz, Int16>)
📝 Debug log file will be written to: /private/var/mobile/Containers/Data/Application/5482472C-556F-4D00-9909-19A403CF1FA8/tmp/debug_log.txt
🛠 🎛️ Audio Settings - Threshold: 0.010000001, Window: 0.5s, MinDuration: 0.5s
📝 Created new audio file: A0F080B6-E3FA-4C20-B907-4C234854B95C.wav
📝 Format: <AVAudioFormat 0x303415900:  1 ch,  16000 Hz, Int16>

🛠 ✅ finish tapped
📊 Segment finalized: A0F080B6-E3FA-4C20-B907-4C234854B95C.wav, size: 519296 bytes, duration: 16.46s
✅ Audio file valid: duration=16.1s
⚠️ Update skipped: No data to save for ID 6CECBE20-FA5B-4D79-A13B-CA1C50633C89
🎧 Segment file path: /private/var/mobile/Containers/Data/Application/5482472C-556F-4D00-9909-19A403CF1FA8/tmp/A0F080B6-E3FA-4C20-B907-4C234854B95C.wav
🛠 WhisperQueue ▶︎ Enqueuing background task for: A0F080B6-E3FA-4C20-B907-4C234854B95C.wav
🛠 🔵 Wrote form data to temporary file: /private/var/mobile/Containers/Data/Application/5482472C-556F-4D00-9909-19A403CF1FA8/tmp/upload_9718E201-1C40-43C5-B0CE-0B402DD7AE62.formdata
🔵 [1] Registering task metadata.
🛠 🔵 [1] Starting background upload task for A0F080B6-E3FA-4C20-B907-4C234854B95C.wav

🔵 [1] Received data chunk: 194 bytes
🔵 [1] Task Completed.
✅ [1] Success: このままの状態で、コメントが大荒れしたこともある えー! ほんとに、500人くらいの人がずーっと言い合いをする えー! こともあるほど
🗑️ [1] Deleting temp file: /private/var/mobile/Containers/Data/Application/5482472C-556F-4D00-9909-19A403CF1FA8/tmp/upload_9718E201-1C40-43C5-B0CE-0B402DD7AE62.formdata

✅ Saved full audio to: \(destinationFullAudioURL.path)
✅ Saved 10 history items to UserDefaults.
📝 Updated history item: ID 6CECBE20-FA5B-4D79-A13B-CA1C50633C89
⚠️ Segment file not found in Documents: segment_D06ED6FF-AA9A-4C95-9C67-C95764986C46_630974A3-276E-4E22-A9CA-76DBA43881F5.wav
🛠 🔄 resetPlayer called with URL: nil
🛠 🗑️ No URL provided, clearing player

📊 Token calculation:
  - Original: 204文字
  - Compressed (70%): 142文字
  - Output tokens: 71
  - Total allocated: 4000

📝 Gemini API Request - Max Output Tokens: 4000

📝 Gemini API Response: {
  "candidates": [
    {
      "content": {
        "role": "model"
      },
      "finishReason": "MAX_TOKENS",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 641,
    "totalTokenCount": 4640,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 641
      }
    ],
    "thoughtsTokenCount": 3999
  },
  "modelVersion": "models/gemini-2.5-pro-preview-05-06",
  "responseId": "D_46aLD5Kvutz7IP-4-MEQ"
}
...
📊 Token Usage - Prompt: 641, Total: 4640, Thoughts: 3999
❌ Decoding error: Error Domain=GeminiClient Code=4 "出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。" UserInfo={NSLocalizedDescription=出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。}
❌ Summary generation error: Error Domain=GeminiClient Code=4 "出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。" UserInfo={NSLocalizedDescription=出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。}

📊 Token calculation:
  - Original: 204文字
  - Compressed (30%): 61文字
  - Output tokens: 30
  - Total allocated: 6000

📝 Gemini API Request - Max Output Tokens: 6000

📝 Gemini API Response: {
  "candidates": [
    {
      "content": {
        "role": "model"
      },
      "finishReason": "MAX_TOKENS",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 641,
    "totalTokenCount": 6640,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 641
      }
    ],
    "thoughtsTokenCount": 5999
  },
  "modelVersion": "models/gemini-2.5-pro-preview-05-06",
  "responseId": "hv46aI_dJMGez7IP_ua62AI"
}
...
📊 Token Usage - Prompt: 641, Total: 6640, Thoughts: 5999
❌ Decoding error: Error Domain=GeminiClient Code=4 "出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。" UserInfo={NSLocalizedDescription=出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。}
❌ Summary generation error: Error Domain=GeminiClient Code=4 "出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。" UserInfo={NSLocalizedDescription=出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。}

📊 Token calculation:
  - Original: 204文字
  - Compressed (20%): 40文字
  - Output tokens: 20
  - Total allocated: 6000

📝 Gemini API Request - Max Output Tokens: 6000

📝 Gemini API Response: {
  "candidates": [
    {
      "content": {
        "role": "model"
      },
      "finishReason": "MAX_TOKENS",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 641,
    "totalTokenCount": 6640,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 641
      }
    ],
    "thoughtsTokenCount": 5999
  },
  "modelVersion": "models/gemini-2.5-pro-preview-05-06",
  "responseId": "C_86aMCuH-XzqtsP-Yns6AQ"
}
...
📊 Token Usage - Prompt: 641, Total: 6640, Thoughts: 5999
❌ Decoding error: Error Domain=GeminiClient Code=4 "出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。" UserInfo={NSLocalizedDescription=出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。}
❌ Summary generation error: Error Domain=GeminiClient Code=4 "出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。" UserInfo={NSLocalizedDescription=出力トークン数の上限に達しました。要約レベルを『軽い要約』に変更するか、設定で最大トークン数を増やしてください。}

#FactoryInstall Unable to query results, error: 5
